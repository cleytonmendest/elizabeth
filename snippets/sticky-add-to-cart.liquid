{%- comment -%}
  Sticky Add to Cart Mobile
  Aparece quando usuário rola para baixo (mobile only)

  Parâmetros:
  - product: objeto do produto (obrigatório)
{%- endcomment -%}

{%- liquid
  assign current_variant = product.selected_or_first_available_variant
  assign product_form_id = 'product-form-' | append: section.id
-%}

{{ 'sticky-atc.css' | asset_url | stylesheet_tag }}

<div
  class="fixed bottom-0 left-0 right-0 bg-white border-t shadow-[0_-2px_8px_rgba(0,0,0,0.08)] translate-y-full transition-transform duration-300 ease-in-out z-40 lg:hidden"
  data-sticky-atc
  data-product-id="{{ product.id }}"
>
  <div class="container mx-auto px-3 py-3 flex items-center gap-2">
    {%- comment -%} Info do Produto {%- endcomment -%}
    <div class="flex-1 min-w-0">
      <p class="text-xs truncate font-medium">
        {{ product.title }}
      </p>
      {%- render 'price-v2', use_variant: true -%}
    </div>

    {%- comment -%} Add to Cart Component {%- endcomment -%}
    <add-to-cart class="flex gap-2 items-center">
      {%- form 'product',
        product,
        id: 'sticky-product-form',
        class: 'flex gap-2 items-center w-full',
        novalidate: 'novalidate',
        data-type: 'add-to-cart-form'
      -%}
        <input
          type="hidden"
          name="id"
          value="{{ current_variant.id }}"
          class="product-variant-id"
          {% unless current_variant.available %}disabled{% endunless %}
        >

        {%- comment -%} Quantity Selector {%- endcomment -%}
        <quantity-selector class="border border-gray-300 p-1 flex h-10 w-fit max-w-28">
          <button
            type="button"
            name="minus"
            aria-label="Diminuir quantidade"
            class="h-full flex items-center justify-center w-[25px]"
          >
            {% render 'icon-minus', size: 16 %}
          </button>
          <input
            type="number"
            name="quantity"
            value="1"
            min="1"
            aria-label="Quantidade"
            inputmode="numeric"
            pattern="[0-9]*"
            class="h-full text-center w-[30px]"
          >
          <button
            type="button"
            name="plus"
            aria-label="Aumentar quantidade"
            class="h-full flex items-center justify-center w-[25px]"
          >
            {% render 'icon-plus', size: 16 %}
          </button>
        </quantity-selector>

        {%- comment -%} Botão Add to Cart {%- endcomment -%}
        <button
          type="submit"
          name="add"
          class="flex items-center justify-center bg-black text-white px-4 py-2.5 rounded-lg font-medium transition-all border-0 cursor-pointer whitespace-nowrap flex-shrink-0 min-w-[90px] min-h-[40px] hover:bg-gray-800 disabled:bg-gray-300 disabled:cursor-not-allowed active:scale-[0.97] active:bg-gray-900"
          aria-haspopup="dialog"
          aria-live="polite"
          data-text-desktop="ADICIONAR AO CARRINHO"
          data-text-mobile="Adicionar"
          {% unless current_variant.available %}disabled{% endunless %}
        >
          {% if current_variant.available %}
            Adicionar
          {% else %}
            Esgotado
          {% endif %}
        </button>
      {%- endform -%}
    </add-to-cart>
  </div>
</div>

<script src="{{ 'sticky-atc.js' | asset_url }}" defer></script>
