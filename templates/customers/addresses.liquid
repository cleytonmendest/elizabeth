<!-- /templates/customers/addresses.liquid -->

<div class="py-12 px-4 sm:px-6 lg:px-8">
  <div class="max-w-7xl mx-auto">

    {%- comment -%} Header {%- endcomment -%}
    <div class="mb-8 flex flex-col sm:flex-row sm:items-center sm:justify-between">
      <div class="mb-4 sm:mb-0">
        <h1 class="text-3xl font-bold text-gray-900 mb-2">
          Meus Endereços
        </h1>
        <p class="text-sm text-gray-600">
          Gerencie seus endereços de entrega
        </p>
      </div>
      <button
        type="button"
        onclick="openAddressModal('new')"
        class="inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-lg text-white bg-gray-900 hover:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-900 transition-colors"
      >
        <svg class="mr-2 -ml-1 h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
        </svg>
        Novo Endereço
      </button>
    </div>

    {%- comment -%} Back Link {%- endcomment -%}
    <div class="mb-6">
      <a
        href="{{ routes.account_url }}"
        class="inline-flex items-center text-sm text-gray-600 hover:text-gray-900 transition-colors"
      >
        <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
        </svg>
        Voltar para Minha Conta
      </a>
    </div>

    {%- comment -%} Addresses Grid {%- endcomment -%}
    {%- if customer.addresses.size > 0 -%}
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        {%- for address in customer.addresses -%}
          <div class="bg-white rounded-lg shadow-lg p-6 relative {% if address == customer.default_address %}ring-2 ring-gray-900{% endif %}">

            {%- comment -%} Default Badge {%- endcomment -%}
            {%- if address == customer.default_address -%}
              <div class="absolute top-0 right-0 mt-4 mr-4">
                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-900 text-white">
                  Padrão
                </span>
              </div>
            {%- endif -%}

            {%- comment -%} Address Content {%- endcomment -%}
            <div class="mb-4">
              <div class="flex items-start mb-3">
                <svg class="w-5 h-5 text-gray-400 mr-2 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/>
                </svg>
                <div class="text-sm text-gray-700">
                  <p class="font-medium text-gray-900 mb-1">
                    {{ address.first_name }} {{ address.last_name }}
                  </p>
                  {%- if address.company != blank -%}
                    <p class="text-xs text-gray-600 mb-1">{{ address.company }}</p>
                  {%- endif -%}
                  <p>{{ address.address1 }}</p>
                  {%- if address.address2 != blank -%}
                    <p>{{ address.address2 }}</p>
                  {%- endif -%}
                  <p>
                    {{ address.city }}{%- if address.province_code -%}, {{ address.province_code }}{%- endif -%}
                  </p>
                  <p>CEP: {{ address.zip }}</p>
                  <p>{{ address.country }}</p>
                </div>
              </div>

              {%- if address.phone != blank -%}
                <div class="flex items-center text-sm text-gray-700 mt-3 pt-3 border-t border-gray-100">
                  <svg class="w-4 h-4 text-gray-400 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/>
                  </svg>
                  {{ address.phone }}
                </div>
              {%- endif -%}
            </div>

            {%- comment -%} Action Buttons {%- endcomment -%}
            <div class="flex items-center space-x-2 pt-4 border-t border-gray-100">
              <button
                type="button"
                onclick="openAddressModal('edit-{{ address.id }}')"
                class="flex-1 inline-flex items-center justify-center px-3 py-2 border border-gray-300 rounded-lg text-sm font-medium text-gray-900 bg-white hover:bg-gray-50 transition-colors"
              >
                <svg class="w-4 h-4 mr-1.5" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
                </svg>
                Editar
              </button>

              {%- if address != customer.default_address -%}
                <button
                  type="button"
                  onclick="confirmDeleteAddress({{ address.id }})"
                  class="inline-flex items-center justify-center px-3 py-2 border border-red-300 rounded-lg text-sm font-medium text-red-700 bg-white hover:bg-red-50 transition-colors"
                  aria-label="Excluir endereço"
                >
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                  </svg>
                </button>
              {%- endif -%}
            </div>

            {%- comment -%} Set as Default {%- endcomment -%}
            {%- if address != customer.default_address -%}
              <form method="post" action="{{ routes.account_addresses_url }}/{{ address.id }}" class="mt-3">
                <input type="hidden" name="_method" value="put">
                <input type="hidden" name="address[default]" value="true">
                <button
                  type="submit"
                  class="w-full text-xs text-gray-600 hover:text-gray-900 font-medium transition-colors py-2"
                >
                  Definir como padrão
                </button>
              </form>
            {%- endif -%}
          </div>
        {%- endfor -%}
      </div>

    {%- else -%}
      {%- comment -%} Empty State {%- endcomment -%}
      <div class="bg-white rounded-lg shadow-lg p-12 text-center">
        <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/>
        </svg>
        <h3 class="mt-2 text-sm font-medium text-gray-900">Nenhum endereço cadastrado</h3>
        <p class="mt-1 text-sm text-gray-500">
          Adicione seu primeiro endereço para facilitar suas compras.
        </p>
        <div class="mt-6">
          <button
            type="button"
            onclick="openAddressModal('new')"
            class="inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-lg text-white bg-gray-900 hover:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-900 transition-colors"
          >
            <svg class="mr-2 -ml-1 h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
            </svg>
            Adicionar Endereço
          </button>
        </div>
      </div>
    {%- endif -%}

  </div>
</div>

{%- comment -%} Modal for New Address {%- endcomment -%}
<div id="address-modal-new" class="address-modal hidden fixed inset-0 bg-gray-500 bg-opacity-75 z-50 overflow-y-auto" aria-labelledby="modal-title" role="dialog" aria-modal="true">
  <div class="flex items-center justify-center min-h-screen px-4 pt-4 pb-20 text-center sm:block sm:p-0">
    <div class="fixed inset-0 transition-opacity" aria-hidden="true" onclick="closeAddressModal('new')"></div>
    <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>

    <div class="inline-block align-bottom bg-white rounded-lg px-4 pt-5 pb-4 text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-2xl sm:w-full sm:p-6">
      <div class="absolute top-0 right-0 pt-4 pr-4">
        <button type="button" onclick="closeAddressModal('new')" class="bg-white rounded-md text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-900">
          <span class="sr-only">Fechar</span>
          <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
          </svg>
        </button>
      </div>

      <div class="sm:flex sm:items-start mb-6">
        <div class="mt-3 text-center sm:mt-0 sm:text-left">
          <h3 class="text-lg leading-6 font-bold text-gray-900" id="modal-title">
            Novo Endereço
          </h3>
        </div>
      </div>

      {% form 'customer_address', customer.new_address %}
        <div class="grid grid-cols-1 gap-4 sm:grid-cols-2">

          <div>
            <label for="address_first_name_new" class="block text-sm font-medium text-gray-700 mb-1">
              Nome *
            </label>
            <input
              type="text"
              id="address_first_name_new"
              name="address[first_name]"
              required
              class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-900 focus:border-transparent"
            >
          </div>

          <div>
            <label for="address_last_name_new" class="block text-sm font-medium text-gray-700 mb-1">
              Sobrenome *
            </label>
            <input
              type="text"
              id="address_last_name_new"
              name="address[last_name]"
              required
              class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-900 focus:border-transparent"
            >
          </div>

          <div class="sm:col-span-2">
            <label for="address_company_new" class="block text-sm font-medium text-gray-700 mb-1">
              Empresa (opcional)
            </label>
            <input
              type="text"
              id="address_company_new"
              name="address[company]"
              class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-900 focus:border-transparent"
            >
          </div>

          <div>
            <label for="address_zip_new" class="block text-sm font-medium text-gray-700 mb-1">
              CEP *
            </label>
            <input
              type="text"
              id="address_zip_new"
              name="address[zip]"
              required
              placeholder="00000-000"
              maxlength="9"
              class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-900 focus:border-transparent"
              onblur="searchCEP('new')"
            >
            <p class="mt-1 text-xs text-gray-500">Buscaremos o endereço automaticamente</p>
          </div>

          <div>
            <label for="address_phone_new" class="block text-sm font-medium text-gray-700 mb-1">
              Telefone
            </label>
            <input
              type="tel"
              id="address_phone_new"
              name="address[phone]"
              placeholder="(00) 00000-0000"
              class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-900 focus:border-transparent"
            >
          </div>

          <div class="sm:col-span-2">
            <label for="address_address1_new" class="block text-sm font-medium text-gray-700 mb-1">
              Endereço *
            </label>
            <input
              type="text"
              id="address_address1_new"
              name="address[address1]"
              required
              placeholder="Rua, Avenida, etc."
              class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-900 focus:border-transparent"
            >
          </div>

          <div class="sm:col-span-2">
            <label for="address_address2_new" class="block text-sm font-medium text-gray-700 mb-1">
              Complemento (opcional)
            </label>
            <input
              type="text"
              id="address_address2_new"
              name="address[address2]"
              placeholder="Apartamento, bloco, etc."
              class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-900 focus:border-transparent"
            >
          </div>

          <div>
            <label for="address_city_new" class="block text-sm font-medium text-gray-700 mb-1">
              Cidade *
            </label>
            <input
              type="text"
              id="address_city_new"
              name="address[city]"
              required
              class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-900 focus:border-transparent"
            >
          </div>

          <div>
            <label for="address_province_new" class="block text-sm font-medium text-gray-700 mb-1">
              Estado *
            </label>
            <select
              id="address_province_new"
              name="address[province]"
              required
              class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-900 focus:border-transparent"
            >
              <option value="">Selecione...</option>
              <option value="AC">Acre</option>
              <option value="AL">Alagoas</option>
              <option value="AP">Amapá</option>
              <option value="AM">Amazonas</option>
              <option value="BA">Bahia</option>
              <option value="CE">Ceará</option>
              <option value="DF">Distrito Federal</option>
              <option value="ES">Espírito Santo</option>
              <option value="GO">Goiás</option>
              <option value="MA">Maranhão</option>
              <option value="MT">Mato Grosso</option>
              <option value="MS">Mato Grosso do Sul</option>
              <option value="MG">Minas Gerais</option>
              <option value="PA">Pará</option>
              <option value="PB">Paraíba</option>
              <option value="PR">Paraná</option>
              <option value="PE">Pernambuco</option>
              <option value="PI">Piauí</option>
              <option value="RJ">Rio de Janeiro</option>
              <option value="RN">Rio Grande do Norte</option>
              <option value="RS">Rio Grande do Sul</option>
              <option value="RO">Rondônia</option>
              <option value="RR">Roraima</option>
              <option value="SC">Santa Catarina</option>
              <option value="SP">São Paulo</option>
              <option value="SE">Sergipe</option>
              <option value="TO">Tocantins</option>
            </select>
          </div>

          <div class="sm:col-span-2">
            <label for="address_country_new" class="block text-sm font-medium text-gray-700 mb-1">
              País *
            </label>
            <select
              id="address_country_new"
              name="address[country]"
              required
              class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-900 focus:border-transparent"
            >
              <option value="Brazil" selected>Brasil</option>
            </select>
          </div>

        </div>

        <div class="mt-6 flex items-center justify-end space-x-3">
          <button
            type="button"
            onclick="closeAddressModal('new')"
            class="px-4 py-2 border border-gray-300 rounded-lg text-sm font-medium text-gray-900 bg-white hover:bg-gray-50 transition-colors"
          >
            Cancelar
          </button>
          <button
            type="submit"
            class="px-4 py-2 border border-transparent rounded-lg shadow-sm text-sm font-medium text-white bg-gray-900 hover:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-900 transition-colors"
          >
            Salvar Endereço
          </button>
        </div>

      {% endform %}
    </div>
  </div>
</div>

{%- comment -%} Modals for Editing Each Address {%- endcomment -%}
{%- for address in customer.addresses -%}
<div id="address-modal-edit-{{ address.id }}" class="address-modal hidden fixed inset-0 bg-gray-500 bg-opacity-75 z-50 overflow-y-auto" aria-labelledby="modal-title-{{ address.id }}" role="dialog" aria-modal="true">
  <div class="flex items-center justify-center min-h-screen px-4 pt-4 pb-20 text-center sm:block sm:p-0">
    <div class="fixed inset-0 transition-opacity" aria-hidden="true" onclick="closeAddressModal('edit-{{ address.id }}')"></div>
    <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>

    <div class="inline-block align-bottom bg-white rounded-lg px-4 pt-5 pb-4 text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-2xl sm:w-full sm:p-6">
      <div class="absolute top-0 right-0 pt-4 pr-4">
        <button type="button" onclick="closeAddressModal('edit-{{ address.id }}')" class="bg-white rounded-md text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-900">
          <span class="sr-only">Fechar</span>
          <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
          </svg>
        </button>
      </div>

      <div class="sm:flex sm:items-start mb-6">
        <div class="mt-3 text-center sm:mt-0 sm:text-left">
          <h3 class="text-lg leading-6 font-bold text-gray-900" id="modal-title-{{ address.id }}">
            Editar Endereço
          </h3>
        </div>
      </div>

      {% form 'customer_address', address %}
        <div class="grid grid-cols-1 gap-4 sm:grid-cols-2">

          <div>
            <label for="address_first_name_{{ address.id }}" class="block text-sm font-medium text-gray-700 mb-1">
              Nome *
            </label>
            <input
              type="text"
              id="address_first_name_{{ address.id }}"
              name="address[first_name]"
              value="{{ address.first_name }}"
              required
              class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-900 focus:border-transparent"
            >
          </div>

          <div>
            <label for="address_last_name_{{ address.id }}" class="block text-sm font-medium text-gray-700 mb-1">
              Sobrenome *
            </label>
            <input
              type="text"
              id="address_last_name_{{ address.id }}"
              name="address[last_name]"
              value="{{ address.last_name }}"
              required
              class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-900 focus:border-transparent"
            >
          </div>

          <div class="sm:col-span-2">
            <label for="address_company_{{ address.id }}" class="block text-sm font-medium text-gray-700 mb-1">
              Empresa (opcional)
            </label>
            <input
              type="text"
              id="address_company_{{ address.id }}"
              name="address[company]"
              value="{{ address.company }}"
              class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-900 focus:border-transparent"
            >
          </div>

          <div>
            <label for="address_zip_{{ address.id }}" class="block text-sm font-medium text-gray-700 mb-1">
              CEP *
            </label>
            <input
              type="text"
              id="address_zip_{{ address.id }}"
              name="address[zip]"
              value="{{ address.zip }}"
              required
              placeholder="00000-000"
              maxlength="9"
              class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-900 focus:border-transparent"
              onblur="searchCEP('{{ address.id }}')"
            >
          </div>

          <div>
            <label for="address_phone_{{ address.id }}" class="block text-sm font-medium text-gray-700 mb-1">
              Telefone
            </label>
            <input
              type="tel"
              id="address_phone_{{ address.id }}"
              name="address[phone]"
              value="{{ address.phone }}"
              placeholder="(00) 00000-0000"
              class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-900 focus:border-transparent"
            >
          </div>

          <div class="sm:col-span-2">
            <label for="address_address1_{{ address.id }}" class="block text-sm font-medium text-gray-700 mb-1">
              Endereço *
            </label>
            <input
              type="text"
              id="address_address1_{{ address.id }}"
              name="address[address1]"
              value="{{ address.address1 }}"
              required
              placeholder="Rua, Avenida, etc."
              class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-900 focus:border-transparent"
            >
          </div>

          <div class="sm:col-span-2">
            <label for="address_address2_{{ address.id }}" class="block text-sm font-medium text-gray-700 mb-1">
              Complemento (opcional)
            </label>
            <input
              type="text"
              id="address_address2_{{ address.id }}"
              name="address[address2]"
              value="{{ address.address2 }}"
              placeholder="Apartamento, bloco, etc."
              class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-900 focus:border-transparent"
            >
          </div>

          <div>
            <label for="address_city_{{ address.id }}" class="block text-sm font-medium text-gray-700 mb-1">
              Cidade *
            </label>
            <input
              type="text"
              id="address_city_{{ address.id }}"
              name="address[city]"
              value="{{ address.city }}"
              required
              class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-900 focus:border-transparent"
            >
          </div>

          <div>
            <label for="address_province_{{ address.id }}" class="block text-sm font-medium text-gray-700 mb-1">
              Estado *
            </label>
            <select
              id="address_province_{{ address.id }}"
              name="address[province]"
              required
              class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-900 focus:border-transparent"
            >
              <option value="">Selecione...</option>
              <option value="AC" {% if address.province_code == 'AC' %}selected{% endif %}>Acre</option>
              <option value="AL" {% if address.province_code == 'AL' %}selected{% endif %}>Alagoas</option>
              <option value="AP" {% if address.province_code == 'AP' %}selected{% endif %}>Amapá</option>
              <option value="AM" {% if address.province_code == 'AM' %}selected{% endif %}>Amazonas</option>
              <option value="BA" {% if address.province_code == 'BA' %}selected{% endif %}>Bahia</option>
              <option value="CE" {% if address.province_code == 'CE' %}selected{% endif %}>Ceará</option>
              <option value="DF" {% if address.province_code == 'DF' %}selected{% endif %}>Distrito Federal</option>
              <option value="ES" {% if address.province_code == 'ES' %}selected{% endif %}>Espírito Santo</option>
              <option value="GO" {% if address.province_code == 'GO' %}selected{% endif %}>Goiás</option>
              <option value="MA" {% if address.province_code == 'MA' %}selected{% endif %}>Maranhão</option>
              <option value="MT" {% if address.province_code == 'MT' %}selected{% endif %}>Mato Grosso</option>
              <option value="MS" {% if address.province_code == 'MS' %}selected{% endif %}>Mato Grosso do Sul</option>
              <option value="MG" {% if address.province_code == 'MG' %}selected{% endif %}>Minas Gerais</option>
              <option value="PA" {% if address.province_code == 'PA' %}selected{% endif %}>Pará</option>
              <option value="PB" {% if address.province_code == 'PB' %}selected{% endif %}>Paraíba</option>
              <option value="PR" {% if address.province_code == 'PR' %}selected{% endif %}>Paraná</option>
              <option value="PE" {% if address.province_code == 'PE' %}selected{% endif %}>Pernambuco</option>
              <option value="PI" {% if address.province_code == 'PI' %}selected{% endif %}>Piauí</option>
              <option value="RJ" {% if address.province_code == 'RJ' %}selected{% endif %}>Rio de Janeiro</option>
              <option value="RN" {% if address.province_code == 'RN' %}selected{% endif %}>Rio Grande do Norte</option>
              <option value="RS" {% if address.province_code == 'RS' %}selected{% endif %}>Rio Grande do Sul</option>
              <option value="RO" {% if address.province_code == 'RO' %}selected{% endif %}>Rondônia</option>
              <option value="RR" {% if address.province_code == 'RR' %}selected{% endif %}>Roraima</option>
              <option value="SC" {% if address.province_code == 'SC' %}selected{% endif %}>Santa Catarina</option>
              <option value="SP" {% if address.province_code == 'SP' %}selected{% endif %}>São Paulo</option>
              <option value="SE" {% if address.province_code == 'SE' %}selected{% endif %}>Sergipe</option>
              <option value="TO" {% if address.province_code == 'TO' %}selected{% endif %}>Tocantins</option>
            </select>
          </div>

          <div class="sm:col-span-2">
            <label for="address_country_{{ address.id }}" class="block text-sm font-medium text-gray-700 mb-1">
              País *
            </label>
            <select
              id="address_country_{{ address.id }}"
              name="address[country]"
              required
              class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-900 focus:border-transparent"
            >
              <option value="Brazil" {% if address.country == 'Brazil' %}selected{% endif %}>Brasil</option>
            </select>
          </div>

        </div>

        <div class="mt-6 flex items-center justify-end space-x-3">
          <button
            type="button"
            onclick="closeAddressModal('edit-{{ address.id }}')"
            class="px-4 py-2 border border-gray-300 rounded-lg text-sm font-medium text-gray-900 bg-white hover:bg-gray-50 transition-colors"
          >
            Cancelar
          </button>
          <button
            type="submit"
            class="px-4 py-2 border border-transparent rounded-lg shadow-sm text-sm font-medium text-white bg-gray-900 hover:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-900 transition-colors"
          >
            Salvar Alterações
          </button>
        </div>

      {% endform %}
    </div>
  </div>
</div>
{%- endfor -%}

{%- comment -%} Delete Confirmation Modal {%- endcomment -%}
<div id="delete-modal" class="hidden fixed inset-0 bg-gray-500 bg-opacity-75 z-50" role="dialog" aria-modal="true">
  <div class="flex items-center justify-center min-h-screen px-4">
    <div class="bg-white rounded-lg p-6 max-w-sm w-full">
      <div class="flex items-center mb-4">
        <div class="mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-red-100">
          <svg class="h-6 w-6 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
          </svg>
        </div>
      </div>
      <h3 class="text-lg font-bold text-gray-900 mb-2 text-center">Confirmar Exclusão</h3>
      <p class="text-sm text-gray-600 mb-6 text-center">
        Tem certeza que deseja excluir este endereço? Esta ação não pode ser desfeita.
      </p>
      <div class="flex space-x-3">
        <button
          type="button"
          onclick="closeDeleteModal()"
          class="flex-1 px-4 py-2 border border-gray-300 rounded-lg text-sm font-medium text-gray-900 bg-white hover:bg-gray-50 transition-colors"
        >
          Cancelar
        </button>
        <form id="delete-form" method="post" action="" class="flex-1">
          <input type="hidden" name="_method" value="delete">
          <button
            type="submit"
            class="w-full px-4 py-2 border border-transparent rounded-lg text-sm font-medium text-white bg-red-600 hover:bg-red-700 transition-colors"
          >
            Excluir
          </button>
        </form>
      </div>
    </div>
  </div>
</div>

<script>
// Modal Functions
function openAddressModal(modalId) {
  const modal = document.getElementById('address-modal-' + modalId);
  if (modal) {
    modal.classList.remove('hidden');
    document.body.style.overflow = 'hidden';
  }
}

function closeAddressModal(modalId) {
  const modal = document.getElementById('address-modal-' + modalId);
  if (modal) {
    modal.classList.add('hidden');
    document.body.style.overflow = '';
  }
}

// Delete Confirmation
function confirmDeleteAddress(addressId) {
  const modal = document.getElementById('delete-modal');
  const form = document.getElementById('delete-form');

  form.action = '{{ routes.account_addresses_url }}/' + addressId;
  modal.classList.remove('hidden');
  document.body.style.overflow = 'hidden';
}

function closeDeleteModal() {
  const modal = document.getElementById('delete-modal');
  modal.classList.add('hidden');
  document.body.style.overflow = '';
}

// CEP Search (ViaCEP API)
async function searchCEP(formId) {
  const cepInput = document.getElementById('address_zip_' + formId);
  const cep = cepInput.value.replace(/\D/g, '');

  if (cep.length !== 8) return;

  try {
    const response = await fetch(`https://viacep.com.br/ws/${cep}/json/`);
    const data = await response.json();

    if (!data.erro) {
      // Fill address fields
      document.getElementById('address_address1_' + formId).value = data.logradouro;
      document.getElementById('address_city_' + formId).value = data.localidade;
      document.getElementById('address_address2_' + formId).value = data.complemento;

      // Set state
      const stateSelect = document.getElementById('address_province_' + formId);
      stateSelect.value = data.uf;

      // Focus on address number field or complement
      document.getElementById('address_address2_' + formId).focus();
    }
  } catch (error) {
    console.error('Erro ao buscar CEP:', error);
  }
}

// Format CEP input
document.addEventListener('DOMContentLoaded', function() {
  const cepInputs = document.querySelectorAll('input[name="address[zip]"]');

  cepInputs.forEach(input => {
    input.addEventListener('input', function(e) {
      let value = e.target.value.replace(/\D/g, '');

      if (value.length > 8) {
        value = value.substr(0, 8);
      }

      if (value.length > 5) {
        value = value.substr(0, 5) + '-' + value.substr(5);
      }

      e.target.value = value;
    });
  });

  // Format phone inputs
  const phoneInputs = document.querySelectorAll('input[name="address[phone]"]');

  phoneInputs.forEach(input => {
    input.addEventListener('input', function(e) {
      let value = e.target.value.replace(/\D/g, '');

      if (value.length > 11) {
        value = value.substr(0, 11);
      }

      if (value.length > 10) {
        value = '(' + value.substr(0, 2) + ') ' + value.substr(2, 5) + '-' + value.substr(7);
      } else if (value.length > 6) {
        value = '(' + value.substr(0, 2) + ') ' + value.substr(2, 4) + '-' + value.substr(6);
      } else if (value.length > 2) {
        value = '(' + value.substr(0, 2) + ') ' + value.substr(2);
      }

      e.target.value = value;
    });
  });

  // Close modals with ESC key
  document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
      const openModals = document.querySelectorAll('.address-modal:not(.hidden)');
      openModals.forEach(modal => {
        modal.classList.add('hidden');
      });

      const deleteModal = document.getElementById('delete-modal');
      if (!deleteModal.classList.contains('hidden')) {
        closeDeleteModal();
      }

      document.body.style.overflow = '';
    }
  });
});
</script>
